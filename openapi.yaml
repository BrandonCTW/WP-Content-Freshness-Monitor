openapi: 3.0.3
info:
  title: Content Freshness Monitor API
  description: |
    REST API for the Content Freshness Monitor WordPress plugin.

    This API allows you to:
    - Get content freshness statistics
    - List stale posts with pagination
    - Check freshness status of individual posts
    - Mark posts as reviewed
    - Access plugin settings

    ## Authentication

    All endpoints require WordPress authentication. Use one of:
    - Cookie authentication (for browser-based requests)
    - Application Passwords (recommended for external integrations)
    - JWT tokens (via third-party plugins)

    ## Permissions

    - **Read endpoints** (`/stats`, `/stale`, `/post/{id}/freshness`): Require `edit_posts` capability
    - **Write endpoints** (`/post/{id}/review`, `/bulk-review`): Require `edit_posts` capability
    - **Settings endpoint** (`/settings`): Requires `manage_options` capability (administrators only)
  version: 2.4.0
  license:
    name: GPL-2.0-or-later
    url: https://www.gnu.org/licenses/gpl-2.0.html
  contact:
    name: Content Freshness Monitor
    url: https://github.com/YOUR_USERNAME/content-freshness-monitor

servers:
  - url: /wp-json/content-freshness-monitor/v1
    description: WordPress REST API base

tags:
  - name: Statistics
    description: Content freshness statistics and health metrics
  - name: Posts
    description: Individual post freshness operations
  - name: Bulk Operations
    description: Batch operations on multiple posts
  - name: Settings
    description: Plugin configuration (admin only)

paths:
  /stats:
    get:
      tags:
        - Statistics
      summary: Get content freshness statistics
      description: |
        Returns aggregate statistics about content freshness across your site,
        including the Content Health Score grade.
      operationId: getStats
      security:
        - cookieAuth: []
        - applicationPassword: []
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Stats'
              example:
                total_posts: 150
                stale_posts: 23
                fresh_posts: 127
                stale_percent: 15.3
                threshold_days: 180
                health_score: 85
                health_grade: B
                health_label: Good
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /stale:
    get:
      tags:
        - Posts
      summary: Get list of stale posts
      description: |
        Returns a paginated list of posts that exceed the staleness threshold.
        Supports sorting and pagination via query parameters.
      operationId: getStalePosts
      security:
        - cookieAuth: []
        - applicationPassword: []
      parameters:
        - name: per_page
          in: query
          description: Number of posts per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: orderby
          in: query
          description: Field to sort by
          schema:
            type: string
            enum:
              - modified
              - title
              - date
              - ID
            default: modified
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - ASC
              - DESC
            default: ASC
      responses:
        '200':
          description: Stale posts retrieved successfully
          headers:
            X-WP-Total:
              description: Total number of stale posts
              schema:
                type: integer
            X-WP-TotalPages:
              description: Total number of pages
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StalePostsResponse'
        '400':
          description: Invalid orderby parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /post/{id}/freshness:
    get:
      tags:
        - Posts
      summary: Get freshness status of a specific post
      description: |
        Returns detailed freshness information for a single post,
        including status, age, and review history.
      operationId: getPostFreshness
      security:
        - cookieAuth: []
        - applicationPassword: []
      parameters:
        - name: id
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Post freshness retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostFreshness'
              example:
                post_id: 42
                title: "How to Optimize Your Website"
                post_type: post
                status: Stale
                status_class: cfm-stale
                is_stale: true
                days_old: 245
                last_modified: "2024-04-26 10:30:00"
                last_reviewed: null
                edit_url: "https://example.com/wp-admin/post.php?post=42&action=edit"
                view_url: "https://example.com/how-to-optimize-your-website/"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /post/{id}/review:
    post:
      tags:
        - Posts
      summary: Mark a post as reviewed
      description: |
        Marks a post as reviewed, resetting its freshness status.
        This does not modify the post content or modified date.
      operationId: markPostReviewed
      security:
        - cookieAuth: []
        - applicationPassword: []
      parameters:
        - name: id
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Post marked as reviewed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewResponse'
              example:
                success: true
                post_id: 42
                reviewed_date: "2025-12-27 10:30:00"
                message: Post marked as reviewed.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /bulk-review:
    post:
      tags:
        - Bulk Operations
      summary: Bulk mark posts as reviewed
      description: |
        Marks multiple posts as reviewed in a single request.
        Returns counts of successfully updated and failed posts.
      operationId: bulkMarkReviewed
      security:
        - cookieAuth: []
        - applicationPassword: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - post_ids
              properties:
                post_ids:
                  type: array
                  description: Array of post IDs to mark as reviewed
                  items:
                    type: integer
                    minimum: 1
                  minItems: 1
                  example: [42, 55, 78]
      responses:
        '200':
          description: Bulk review completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkReviewResponse'
              example:
                success: true
                updated_count: 3
                updated_posts: [42, 55, 78]
                failed_posts: []
                reviewed_date: "2025-12-27 10:30:00"
                message: 3 posts marked as reviewed.
        '400':
          description: Invalid post_ids parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /settings:
    get:
      tags:
        - Settings
      summary: Get plugin settings
      description: |
        Returns the current plugin configuration.
        Requires administrator privileges (`manage_options` capability).
      operationId: getSettings
      security:
        - cookieAuth: []
        - applicationPassword: []
      responses:
        '200':
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
              example:
                threshold_days: 180
                monitored_post_types:
                  - post
                  - page
                excluded_ids: []
                show_in_list: true
                email_enabled: false
                email_frequency: weekly
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: wordpress_logged_in
      description: WordPress authentication cookie
    applicationPassword:
      type: http
      scheme: basic
      description: WordPress Application Password (username:application-password)

  schemas:
    Stats:
      type: object
      properties:
        total_posts:
          type: integer
          description: Total number of monitored posts
        stale_posts:
          type: integer
          description: Number of posts exceeding staleness threshold
        fresh_posts:
          type: integer
          description: Number of posts within freshness threshold
        stale_percent:
          type: number
          format: float
          description: Percentage of content that is stale
        threshold_days:
          type: integer
          description: Current staleness threshold in days
        health_score:
          type: integer
          minimum: 0
          maximum: 100
          description: Content health score (0-100)
        health_grade:
          type: string
          enum: [A, B, C, D, F]
          description: Letter grade for content health
        health_label:
          type: string
          enum: [Excellent, Good, Fair, Poor, Critical]
          description: Human-readable health label

    StalePost:
      type: object
      properties:
        id:
          type: integer
          description: Post ID
        title:
          type: string
          description: Post title
        post_type:
          type: string
          description: Post type (post, page, etc.)
        days_old:
          type: integer
          description: Days since last modification
        last_modified:
          type: string
          format: date-time
          description: Last modification date
        edit_url:
          type: string
          format: uri
          description: URL to edit the post
        view_url:
          type: string
          format: uri
          description: URL to view the post

    StalePostsResponse:
      type: object
      properties:
        posts:
          type: array
          items:
            $ref: '#/components/schemas/StalePost'
        total:
          type: integer
          description: Total number of stale posts
        total_pages:
          type: integer
          description: Total number of pages
        page:
          type: integer
          description: Current page number
        per_page:
          type: integer
          description: Posts per page

    PostFreshness:
      type: object
      properties:
        post_id:
          type: integer
          description: Post ID
        title:
          type: string
          description: Post title
        post_type:
          type: string
          description: Post type
        status:
          type: string
          enum: [Fresh, Aging, Stale]
          description: Freshness status label
        status_class:
          type: string
          enum: [cfm-fresh, cfm-aging, cfm-stale]
          description: CSS class for status styling
        is_stale:
          type: boolean
          description: Whether the post exceeds staleness threshold
        days_old:
          type: integer
          description: Days since last modification
        last_modified:
          type: string
          format: date-time
          description: Last modification date
        last_reviewed:
          type: string
          format: date-time
          nullable: true
          description: Last reviewed date, or null if never reviewed
        edit_url:
          type: string
          format: uri
          description: URL to edit the post
        view_url:
          type: string
          format: uri
          description: URL to view the post

    ReviewResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation succeeded
        post_id:
          type: integer
          description: The reviewed post ID
        reviewed_date:
          type: string
          format: date-time
          description: The timestamp when marked as reviewed
        message:
          type: string
          description: Human-readable success message

    BulkReviewResponse:
      type: object
      properties:
        success:
          type: boolean
          description: True if all posts were updated successfully
        updated_count:
          type: integer
          description: Number of posts successfully updated
        updated_posts:
          type: array
          items:
            type: integer
          description: IDs of successfully updated posts
        failed_posts:
          type: array
          items:
            type: integer
          description: IDs of posts that failed to update
        reviewed_date:
          type: string
          format: date-time
          description: The timestamp when marked as reviewed
        message:
          type: string
          description: Human-readable result message

    Settings:
      type: object
      properties:
        threshold_days:
          type: integer
          description: Staleness threshold in days
        monitored_post_types:
          type: array
          items:
            type: string
          description: Post types being monitored
        excluded_ids:
          type: array
          items:
            type: integer
          description: Post IDs excluded from monitoring
        show_in_list:
          type: boolean
          description: Whether to show freshness column in post list
        email_enabled:
          type: boolean
          description: Whether email notifications are enabled
        email_frequency:
          type: string
          enum: [daily, weekly, monthly]
          description: Email notification frequency

    Error:
      type: object
      properties:
        code:
          type: string
          description: Error code
        message:
          type: string
          description: Error message
        data:
          type: object
          properties:
            status:
              type: integer
              description: HTTP status code

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: rest_not_logged_in
            message: You are not currently logged in.
            data:
              status: 401

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: rest_forbidden
            message: You do not have permission to access this resource.
            data:
              status: 403

    NotFound:
      description: Post not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: rest_post_not_found
            message: Post not found.
            data:
              status: 404
